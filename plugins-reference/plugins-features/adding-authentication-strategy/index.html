<!doctype html><html><head><meta http-equiv=Content-Type content="text/html; charset=utf-8"><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=msapplication-TileColor content=#FFFFFF><meta name=msapplication-TileImage content=http://docs.kuzzle.io/assets/images/favicon/mstile-144x144.png><meta name=msapplication-square70x70logo content=http://docs.kuzzle.io/assets/images/favicon/mstile-70x70.png><meta name=msapplication-square150x150logo content=http://docs.kuzzle.io/assets/images/favicon/mstile-150x150.png><meta name=msapplication-wide310x150logo content=http://docs.kuzzle.io/assets/images/favicon/mstile-310x150.png><meta name=msapplication-square310x310logo content=http://docs.kuzzle.io/assets/images/favicon/mstile-310x310.png><meta name=google-site-verification content=luspUdq52gkUU0FFChQ2xmeXSs5HDafpARQ7fVXVBp4><meta itemprop=name content="Adding an authentication strategy"><meta itemprop=image content=http://docs.kuzzle.io/assets/images/favicon/favicon-196x196.png><meta name=twitter:card value=summary><meta name=twitter:site content=@kuzzleio><meta name=twitter:title content="Adding an authentication strategy"><meta name=twitter:creator content=@kuzzleio><meta name=twitter:image content=http://docs.kuzzle.io/assets/images/favicon/favicon-196x196.png><meta property=og:title content="Adding an authentication strategy"><meta property=og:type content=article><meta property=og:site_name content=""><meta property=og:image content=http://docs.kuzzle.io/assets/images/favicon/favicon-96x96.png><meta property=article:published_time content=2017-08-30T15:07:32.787Z><meta property=article:modified_time content=2017-08-30T15:07:32.787Z><meta property=article:section content="Plugins Reference"><meta property=article:tag content="Plugins features"><link rel=apple-touch-icon-precomposed sizes=57x57 href=/assets/images/favicon/apple-touch-icon-57x57.png><link rel=apple-touch-icon-precomposed sizes=114x114 href=/assets/images/favicon/apple-touch-icon-114x114.png><link rel=apple-touch-icon-precomposed sizes=72x72 href=/assets/images/favicon/apple-touch-icon-72x72.png><link rel=apple-touch-icon-precomposed sizes=144x144 href=/assets/images/favicon/apple-touch-icon-144x144.png><link rel=apple-touch-icon-precomposed sizes=60x60 href=/assets/images/favicon/apple-touch-icon-60x60.png><link rel=apple-touch-icon-precomposed sizes=120x120 href=/assets/images/favicon/apple-touch-icon-120x120.png><link rel=apple-touch-icon-precomposed sizes=76x76 href=/assets/images/favicon/apple-touch-icon-76x76.png><link rel=apple-touch-icon-precomposed sizes=152x152 href=/assets/images/favicon/apple-touch-icon-152x152.png><link rel=icon type=image/png href=/assets/images/favicon/favicon-196x196.png sizes=196x196><link rel=icon type=image/png href=/assets/images/favicon/favicon-96x96.png sizes=96x96><link rel=icon type=image/png href=/assets/images/favicon/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/assets/images/favicon/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/assets/images/favicon/favicon-128.png sizes=128x128><link rel=stylesheet href=/assets/font-awesome/scss/font-awesome.css><link href="//fonts.googleapis.com/css?family=Ubuntu:400,500,700" rel=stylesheet><title>Adding an authentication strategy - Plugins features - Plugins Reference - Kuzzle documentation</title><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/atom-one-light.min.css><link href=/assets/stylesheets/full/screen.css rel=stylesheet type=text/css media=screen></head><body class=index><header><div class=wrapper><div id=logo><a href=http://kuzzle.io/ >&#xA0;</a></div><a class=mobile-nav-burger href=javascript:;></a><nav><ul><li><a href=http://kuzzle.io/kuzzle-enterprise/ class=nav-item>product</a></li><li><a href=http://docs.kuzzle.io/ class="nav-item developers active">Documentation</a><ul class=mobile-nav><li><a href=/guide><span>Guide</span></a></li><li><a href=/sdk-reference><span>SDK Reference</span></a></li><li><a href=/kuzzle-dsl><span>Kuzzle DSL</span></a></li><li><a href=/validation-reference><span>Data Validation</span></a></li><li><a href=/api-documentation><span>API Documentation</span></a></li><li class=active><a href=/plugins-reference><span>Plugins Reference</span></a><ul class=sub-nav><li><a href=/plugins-reference/plugins-creation-prerequisites><span>Plugins creation prerequisites</span></a></li><li class=active><a href=/plugins-reference/plugins-features><span>Plugins features</span></a></li><li><a href=/plugins-reference/managing-plugins><span>Managing Plugins</span></a></li><li><a href=/plugins-reference/plugins-context><span>The plugin context</span></a></li><li><a href=/plugins-reference/protocols><span>Protocols</span></a></li></ul></li><li><a href=/kuzzle-events><span>Kuzzle events</span></a></li><li><a href=/elasticsearch-cookbook><span>Elasticsearch Cookbook</span></a></li></ul></li><li><a href=http://kuzzle.io/demos-tutorials/ class=nav-item>Demos</a></li><li><a href=http://kuzzle.io/blog/ class=nav-item>Blog</a></li><li><a href=http://kuzzle.io/contact/ class=nav-item>Contact</a></li><li><a href=http://kuzzle.io/install-kuzzle/ class=nav-item>Try it</a></li><li><a href=https://github.com/kuzzleio/kuzzle target=_blank class="nav-item github"><i class="icon icon-github icon-small"></i></a></li></ul></nav></div><div class="developer-nav open"><ul class=search><li><input name=search type=search placeholder=search tabindex=1></li></ul><ul class=nav><li><a href=/guide><span>Guide</span></a></li><li><a href=/sdk-reference><span>SDK Reference</span></a></li><li><a href=/kuzzle-dsl><span>Kuzzle DSL</span></a></li><li><a href=/validation-reference><span>Data Validation</span></a></li><li><a href=/api-documentation><span>API Documentation</span></a></li><li class=active><a href=/plugins-reference><span>Plugins Reference</span></a></li><li><a href=/kuzzle-events><span>Kuzzle events</span></a></li><li><a href=/elasticsearch-cookbook><span>Elasticsearch Cookbook</span></a></li></ul><div class=search-results><ul></ul></div><script type=text/plain id=search-results-template><li>
        <a href="__link__" tabindex="__tabindex__">
          <p class="page">
            <span class="title">__title__</span>
            <span class="firstMember">__firstMember__</span>
            <span class="parent">__parent__</span>
          </p>
          <p class="preview">__preview__</p>
        </a>
      </li></script></div></header><div class=container><div class=tocify-wrapper><ul class=search-results></ul><div class=tocify><ul class=tocify-header><li class="tocify-item tocify-focus tocify-hover"></li></ul><ul class=tocify-header><li class=tocify-item><a style="color: #111; text-decoration: none" href=http://docs.kuzzle.io/plugins-reference title="back to Plugins Reference home">Plugins Reference</a></li><ul class=tocify-subheader><li class=tocify-item><a style="color: #002835; text-decoration: none" href=/plugins-reference/plugins-creation-prerequisites title="requirements to develop your plugin">Plugins creation prerequisites</a></li><li class="tocify-item tocify-focus"><a style="color: #FFF; text-decoration: none" href=# title="understand Kuzzle plugins mechanisms">Plugins features</a></li><ul class=tocify-header><ul class=tocify-subheader><li class="tocify-item tocify-level-2"><a style="color: #002835; text-decoration: none" href=/plugins-reference/plugins-features title="understand Kuzzle plugins mechanisms">&#x203A; Introduction</a></li><li class="tocify-item tocify-level-2"><a style="color: #002835; text-decoration: none" href=/plugins-reference/plugins-features/adding-hooks title="Listening asynchronously">&#x203A; Listening asynchronously</a></li><li class="tocify-item tocify-level-2"><a style="color: #002835; text-decoration: none" href=/plugins-reference/plugins-features/adding-pipes title="Listening synchronously">&#x203A; Listening synchronously</a></li><li class="tocify-item tocify-level-2"><a style="color: #002835; text-decoration: none" href=/plugins-reference/plugins-features/adding-controllers title="Adding a controller route">&#x203A; Adding a controller route</a></li><li class="tocify-item tocify-level-2 tocify-focus"><a style="color: #FFF; text-decoration: none" href=/plugins-reference/plugins-features/adding-authentication-strategy title="Adding an authentication strategy">&#x203A; Adding an authentication strategy</a></li></ul></ul><li class=tocify-item><a style="color: #002835; text-decoration: none" href=/plugins-reference/managing-plugins title="learn how to enable and configure plugins">Managing Plugins</a></li><li class=tocify-item><a style="color: #002835; text-decoration: none" href=/plugins-reference/plugins-context title="plugin initialization context attribute reference">The plugin context</a></li><li class=tocify-item><a style="color: #002835; text-decoration: none" href=/plugins-reference/protocols title="Extend Kuzzle communication capabilities">Protocols</a></li></ul></ul><ul class=toc-footer></ul></div></div><div class=page-wrapper><div class=toc><ul><li class="toc-item toc-level-1"><a href=#adding-an-authentication-strategy title="Adding an authentication strategy">Adding an authentication strategy</a></li><li class="toc-item toc-level-2"><a href=#choose-or-implement-a-passport-strategy title="Choose or implement a Passport strategy">Choose or implement a Passport strategy</a></li><li class="toc-item toc-level-2"><a href=#expose-authentication-strategies title="Expose authentication strategies">Expose authentication strategies</a></li><li class="toc-item toc-level-2"><a href=#the-verify-function title="The verify function">The verify function</a></li><li class="toc-item toc-level-2"><a href=#the-exists-function title="The exists function">The exists function</a></li><li class="toc-item toc-level-2"><a href=#the-create-function title="The create function">The create function</a></li><li class="toc-item toc-level-2"><a href=#the-update-function title="The update function">The update function</a></li><li class="toc-item toc-level-2"><a href=#the-delete-function title="The delete function">The delete function</a></li><li class="toc-item toc-level-2"><a href=#the-getinfo-function title="The getInfo function">The getInfo function</a></li><li class="toc-item toc-level-2"><a href=#the-getbyid-function title="The getById function">The getById function</a></li><li class="toc-item toc-level-2"><a href=#the-afterregister-function title="The afterRegister function">The afterRegister function</a></li><li class="toc-item toc-level-2"><a href=#the-validate-function title="The validate function">The validate function</a></li><li class="toc-item toc-level-2"><a href=#tl-dr-plugin-skeleton title="TL;DR plugin skeleton">TL;DR plugin skeleton</a></li></ul></div><div class=content><div class=mobile-breadcrumb><p style=float:left><a href=http://docs.kuzzle.io/ >Kuzzle documentation</a> &#xBB; <a href=http://docs.kuzzle.io/plugins-reference>Plugins Reference</a> &#xBB; <a href=http://docs.kuzzle.io/plugins-reference/plugins-features>Plugins features</a> &#xBB; Adding an authentication strategy</p><p style=float:right class=version-selector><select onchange="window.location = this.value"><option selected>1.x</option></select></p></div><div class=nav-sibling><div class=nav-left><p><a href=https://github.com/kuzzleio/documentation/edit/master/src/plugins-reference/plugins-features/adding-authentication-strategy.md>edit on github<i class="icon icon-github icon-small"></i></a> <span class=separator>|</span> <a href="https://github.com/kuzzleio/documentation/issues/new?labels=plugins-reference&amp;title=Feedback%20about%20page%20&apos;plugins-reference/plugins-features/adding-authentication-strategy.md&apos;">send feedback about this content<i class="icon icon-github icon-small"></i></a> <span class=separator>|</span><select class=rate-documentation><option value=""></option><option value=1>Unusable documentation</option><option value=2>Poor documentation</option><option value=3>OK documentation</option><option value=4>Good documentation</option><option value=5>Excellent documentation</option></select></p></div><div class=nav-right><p class=version-selector><span>current version:</span><select onchange="window.location = this.value"><option selected>1.x</option></select></p></div><div style=clear:both></div></div><div class=toc-inline><ul><li class="toc-item toc-level-1"><a href=#adding-an-authentication-strategy title="Adding an authentication strategy">Adding an authentication strategy</a></li><li class="toc-item toc-level-2"><a href=#choose-or-implement-a-passport-strategy title="Choose or implement a Passport strategy">Choose or implement a Passport strategy</a></li><li class="toc-item toc-level-2"><a href=#expose-authentication-strategies title="Expose authentication strategies">Expose authentication strategies</a></li><li class="toc-item toc-level-2"><a href=#the-verify-function title="The verify function">The verify function</a></li><li class="toc-item toc-level-2"><a href=#the-exists-function title="The exists function">The exists function</a></li><li class="toc-item toc-level-2"><a href=#the-create-function title="The create function">The create function</a></li><li class="toc-item toc-level-2"><a href=#the-update-function title="The update function">The update function</a></li><li class="toc-item toc-level-2"><a href=#the-delete-function title="The delete function">The delete function</a></li><li class="toc-item toc-level-2"><a href=#the-getinfo-function title="The getInfo function">The getInfo function</a></li><li class="toc-item toc-level-2"><a href=#the-getbyid-function title="The getById function">The getById function</a></li><li class="toc-item toc-level-2"><a href=#the-afterregister-function title="The afterRegister function">The afterRegister function</a></li><li class="toc-item toc-level-2"><a href=#the-validate-function title="The validate function">The validate function</a></li><li class="toc-item toc-level-2"><a href=#tl-dr-plugin-skeleton title="TL;DR plugin skeleton">TL;DR plugin skeleton</a></li></ul></div><div class=main-content><div class=reading-time><p>Reading time: 29 min</p></div><h1><a class=anchor id=adding-an-authentication-strategy></a>Adding an authentication strategy</h1><p>Kuzzle handles users security and authentication. The supported authentication strategies can be extended by Plugins.</p><p>Any strategy supported by <a href=http://passportjs.org/ >Passport</a> can be used to extend Kuzzle supported strategies, like we did with our official <a href=https://github.com/kuzzleio/kuzzle-plugin-auth-passport-oauth>OAUTH2 Authentication plugin</a>.</p><hr><h2><a class=anchor id=choose-or-implement-a-passport-strategy></a>Choose or implement a Passport strategy</h2><p><a href=http://passportjs.org>Passport</a> supports a wide range of authentication strategies. If that is not enough, you can also implement your own strategy for your authentication Plugin.</p><p>In any case, the chosen strategy must be available in the Plugin local directory when Kuzzle installs it, either by adding the strategy in the Plugin&apos;s NPM dependencies, or by including the strategy code directly in the Plugin repository.</p><hr><h2><a class=anchor id=expose-authentication-strategies></a>Expose authentication strategies</h2><p>There are two ways of declaring authentication strategies:</p><ul><li>By exposing a <code>strategies</code> object in an authentication plugin instance, listing strategies to explose and their properties. That object cannot be empty, and must contain one attribute per added strategy, with the attribute name used as the strategy name;</li><li>By <a href=/plugins-reference/plugins-context/accessors/#strategies>dynamically add or remove strategies</a>.</li></ul><p>Whether strategies are statically or dynamically added, a properties object must be provided for each one of them. That object must be of the following structure:</p><ul><li>config: an object containing the strategy configuration<ul><li>constructor: The constructor of the Passport strategy</li><li>strategyOptions: The options provided to the Passport strategy constructor</li><li>authenticateOptions: The options provided to the Passport&apos;s <a href=http://passportjs.org/docs/authenticate>authenticate method</a>.</li><li>fields: The list of fields that can be provided to the plugin.</li></ul></li><li>methods: an object containing the list of exposed methods<ul><li>afterRegister: The name of the <code>afterRegister</code> function in the plugin object.</li><li>create: [mandatory] The name of the <code>create</code> function in the plugin object.</li><li>delete: [mandatory] The name of the <code>delete</code> function in the plugin object.</li><li>exists: [mandatory] The name of the <code>exists</code> function in the plugin object.</li><li>getById: The name of the <code>getById</code> function in the plugin object.</li><li>getInfo: The name of the <code>getInfo</code> function in the plugin object.</li><li>update: [mandatory] The name of the <code>update</code> function in the plugin object.</li><li>validate: [mandatory] The name of the <code>validate</code> function in the plugin object.</li><li>verify: [mandatory] The name of the <code>verify</code> function in the plugin object.</li></ul></li></ul><p>Even if each strategy must declare its own set of properties, a same strategy method can be used by multiple strategies.</p><hr><h2><a class=anchor id=the-verify-function></a>The verify function</h2><p>You have to implement a <a href=http://passportjs.org/docs/configure><code>verify</code> function</a> (its name depends on the configuration provided in the <code>strategies</code> attribute), which will be used by Kuzzle to authorize or to deny access to a user.</p><p>The number of arguments taken by this <code>verify</code> function depends on the authentication strategy. For instance, a <code>local password</code> strategy needs the <code>verify</code> callback to be provided with an <code>username</code> and his <code>password</code>.</p><p>Here is the generic signature of the <code>verify</code> function you have to implement:</p><p><code>verify(request, ...)</code></p><ul><li><code>request</code> is the login request made to passport. The object format is <code>{query: {passport: &apos;crendentials&apos;}, original: Request}</code> (see <a href=/plugins-reference/plugins-context/constructors/#request>the <code>Request</code> documentation</a>)</li><li><code>...</code>: varies, depending on the used strategy</li></ul><p>The function <strong>must</strong> return a <code>Promise</code> that resolves to an object that can contain two attributes: <code>kuid</code> and <code>message</code>. If the user is authenticated, the <code>kuid</code> attribute must contain the <a href=/guide/kuzzle-depth/authentication/#the-kuzzle-user-identifier-kuid>kuid</a> of the user, else the <code>kuid</code> should be null and the <code>message</code> attribute must contain a string giving the reason the user can not be authenticated. The function should reject the Promise if an error occurs (note: an authentication rejection is <em>not</em> an error).</p><hr><h2><a class=anchor id=the-exists-function></a>The exists function</h2><p>You have to implement an <code>exists</code> function (its name depends on the configuration provided in the <code>strategies</code> attribute), which will be used by Kuzzle to check whether a user has credentials using that strategy or not.</p><p>Here is the generic signature of the <code>exists</code> function you have to implement:</p><p><code>exists (request, kuid, strategy)</code></p><ul><li><code>request</code> is the request made to Kuzzle (see <a href=/plugins-reference/plugins-context/constructors/#request>the <code>Request</code> documentation</a>).</li><li><code>kuid</code> is the user <a href=/guide/kuzzle-depth/authentication/#the-kuzzle-user-identifier-kuid><code>&lt;kuid&gt;</code></a>.</li><li><code>strategy</code> the name of the strategy</li></ul><p>The function <strong>must</strong> return a <code>Promise</code> that resolves to a boolean depending on the user ability to authenticate with a strategy.</p><hr><h2><a class=anchor id=the-create-function></a>The create function</h2><p>You have to implement an <code>create</code> function (its name depends on the configuration provided in the <code>strategies</code> attribute), used by Kuzzle to add credentials to a user using this strategy.</p><p>Here is the generic signature of the <code>create</code> function you have to implement:</p><p><code>create (request, credentials, kuid, strategy)</code></p><ul><li><code>request</code> is the request made to Kuzzle (see <a href=/plugins-reference/plugins-context/constructors/#request>the <code>Request</code> documentation</a>).</li><li><code>credentials</code> is the content of the credentials to create, that have already been passed to your <code>validate</code> function.</li><li><code>kuid</code> is the user <a href=/guide/kuzzle-depth/authentication/#the-kuzzle-user-identifier-kuid><code>&lt;kuid&gt;</code></a>.</li><li><code>strategy</code> the name of the strategy</li></ul><p>The function <strong>must</strong> return a <code>Promise</code> that resolves to an object that contains <strong>non sensitive</strong> information of the object (can be an empty object).</p><aside class=warning>The credentials have to be persisted, either by using the <a href=/plugins-reference/plugins-context/constructors/#repository>Repository constructor</a>, or any external service.</aside><hr><h2><a class=anchor id=the-update-function></a>The update function</h2><p>You have to implement an <code>update</code> function (its name depends on the configuration provided in the <code>strategies</code> attribute), used by Kuzzle to update a user&apos;s credentials to this strategy.</p><p>Here is the generic signature of the <code>update</code> function you have to implement:</p><p><code>update (request, credentials, kuid, strategy)</code></p><ul><li><code>request</code> is the request made to Kuzzle (see <a href=/plugins-reference/plugins-context/constructors/#request>the <code>Request</code> documentation</a>).</li><li><code>credentials</code> is the content of the credentials to create, that have already been passed to your <code>validate</code> function.</li><li><code>kuid</code> is the user <a href=/guide/kuzzle-depth/authentication/#the-kuzzle-user-identifier-kuid><code>&lt;kuid&gt;</code></a>.</li><li><code>strategy</code> the name of the strategy</li></ul><p>The function <strong>must</strong> return a <code>Promise</code> that resolves to an object that contains <strong>non sensitive</strong> information of the object (can be an empty object).</p><aside class=warning>The credentials have to be persisted, either by using the <a href=/plugins-reference/plugins-context/constructors/#repository>Repository constructor</a>, or any external service.</aside><hr><h2><a class=anchor id=the-delete-function></a>The delete function</h2><p>You have to implement a <code>delete</code> function (its name depends on the configuration provided in the <code>strategies</code> attribute), used by Kuzzle to delete a user&apos;s credentials to this strategy.</p><p>Here is the generic signature of the <code>delete</code> function you have to implement:</p><p><code>delete (request, kuid, strategy)</code></p><ul><li><code>request</code> is the request made to Kuzzle (see <a href=/plugins-reference/plugins-context/constructors/#request>the <code>Request</code> documentation</a>).</li><li><code>kuid</code> is the user <a href=/guide/kuzzle-depth/authentication/#the-kuzzle-user-identifier-kuid><code>&lt;kuid&gt;</code></a>.</li><li><code>strategy</code> the name of the strategy</li></ul><p>The function <strong>must</strong> return a <code>Promise</code> that resolves to any value if deletion succeeds.</p><hr><h2><a class=anchor id=the-getinfo-function></a>The getInfo function</h2><p>You may implement a <code>getInfo</code> function (its name depends on the configuration provided in the <code>strategies</code> attribute), used by Kuzzle to get informations about a user&apos;s credentials to this strategy.</p><aside class=warning>Kuzzle will NEVER expose data managed by plugins by itself. Plugins are entirely responsible for the data they expose.<br>For security reasons, only NON SENSITIVE informations should be returned by that method.</aside><p>Here is the generic signature of the <code>getInfo</code> function you have to implement:</p><p><code>getInfo (request, kuid, strategy)</code></p><ul><li><code>request</code> is the request made to Kuzzle (see <a href=/plugins-reference/plugins-context/constructors/#request>the <code>Request</code> documentation</a>).</li><li><code>kuid</code> is the user <a href=/guide/kuzzle-depth/authentication/#the-kuzzle-user-identifier-kuid><code>&lt;kuid&gt;</code></a>.</li><li><code>strategy</code> the name of the strategy</li></ul><p>The function <strong>must</strong> return a <code>Promise</code> that resolves to an object that contains <strong>non sensitive</strong> information of the object (can be an empty object).</p><aside class=info>If no getInfo function is provided, an empty object will be returned by controllers that use it.</aside><hr><h2><a class=anchor id=the-getbyid-function></a>The getById function</h2><p>You may implement a <code>getById</code> function (its name depends on the configuration provided in the <code>strategies</code> attribute), used by Kuzzle to get informations about a user&apos;s credentials to this strategy searching by the strategy storage identifier (<code>_id</code>). For security reasons, only <strong>non sensitive</strong> informations should be returned.</p><p>Here is the generic signature of the <code>getById</code> function you have to implement:</p><p><code>getById (request, id, strategy)</code></p><ul><li><code>request</code> is the request made to Kuzzle (see <a href=/plugins-reference/plugins-context/constructors/#request>the <code>Request</code> documentation</a>).</li><li><code>id</code> is the user&apos;s storage identifier in the strategy.</li><li><code>strategy</code> the name of the strategy</li></ul><p>The function <strong>must</strong> return a <code>Promise</code> that resolves to an object that contains <strong>non sensitive</strong> information of the object (can be an empty object).</p><aside class=info>If no getById function is provided, an empty object will be returned by controllers that use it.</aside><hr><h2><a class=anchor id=the-afterregister-function></a>The afterRegister function</h2><p>You may implement a <code>afterRegister</code> function (its name depends on the configuration provided in the <code>strategies</code> attribute), which will be called once the strategy constructor has been build</p><p>Here is the generic signature of the <code>afterRegister</code> function you have to implement:</p><p><code>afterRegister (constructedStrategy)</code></p><ul><li><code>constructedStrategy</code> is the instance of the Passport strategy constructor.</li></ul><p>The function <strong>may</strong> return any value as it will be ignored.</p><aside class=info>If no afterRegister function is provided, Kuzzle won&apos;t try to call it, and register will process as expected.</aside><hr><h2><a class=anchor id=the-validate-function></a>The validate function</h2><p>You have to implement a <code>validate</code> (its name depends on the configuration provided in the <code>strategies</code> attribute), which will be used by Kuzzle to check if the provided user&apos;s credentials to this strategy are well-formed, and ensure that every values you want are unique.</p><p>Here is the generic signature of the <code>validate</code> function you have to implement:</p><p><code>validate (request, credentials, kuid, strategy, isUpdate)</code></p><ul><li><code>request</code> is the request made to Kuzzle (see <a href=/plugins-reference/plugins-context/constructors/#request>the <code>Request</code> documentation</a>).</li><li><code>credentials</code> is the content of the credentials to create or update.</li><li><code>kuid</code> is the user <a href=/guide/kuzzle-depth/authentication/#the-kuzzle-user-identifier-kuid><code>&lt;kuid&gt;</code></a>.</li><li><code>strategy</code> the name of the strategy</li><li><code>isUpdate</code> is true if <code>validate</code> is called during an update.</li></ul><p>The function <strong>must</strong> return a <code>Promise</code> that resolves or rejects with an error explaining the reason.</p><aside class=warning>Validate can be called during an update with partial information. The validation should behave accordingly when <strong>isUpdate</strong> is <strong>true</strong>, knowing that mandatory information should already have been stored during a previous create call.</aside><hr><h2><a class=anchor id=tl-dr-plugin-skeleton></a>TL;DR plugin skeleton</h2><p>Here is a skeleton example of an authentication plugin:</p><pre><code class="hljs javascript"><span class=hljs-keyword>const</span> StrategyConstructor = <span class=hljs-built_in>require</span>(<span class=hljs-string>&apos;some-passport-strategy&apos;</span>);

<span class=hljs-comment>/**
 * @class AuthenticationPlugin
 */</span>
<span class=hljs-class><span class=hljs-keyword>class</span> <span class=hljs-title>AuthenticationPlugin</span> </span>{
  <span class=hljs-comment>/**
   * @constructor
   */</span>
  <span class=hljs-keyword>constructor</span>() {}

  <span class=hljs-comment>/**
   * @param {object} customConfig
   * @param {KuzzlePluginContext} context
   * @returns {*}
   */</span>
  init (customConfig, context) {
    <span class=hljs-keyword>this</span>.strategies = {
      <span class=hljs-comment>// The name of the strategy</span>
      strategyName: {
        <span class=hljs-attr>config</span>: {
          <span class=hljs-comment>// The constructor of the passport strategy </span>
          <span class=hljs-keyword>constructor</span>: StrategyConstructor,

          // Options provided to the strategy <span class=hljs-keyword>constructor</span> at instantiation
          strategyOptions: {},

          <span class=hljs-comment>// Options provided to the authenticate function during the authentication process</span>
          authenticateOptions: {
            <span class=hljs-attr>scope</span>: []
          },

          <span class=hljs-comment>// The list of fields that have to be provided in the credentials</span>
          fields: [<span class=hljs-string>&apos;login&apos;</span>, <span class=hljs-string>&apos;password&apos;</span>]
        },
        <span class=hljs-attr>methods</span>: {
          <span class=hljs-comment>// (optional) The name of the afterRegister function</span>
          afterRegister: <span class=hljs-string>&apos;afterRegister&apos;</span>,
          <span class=hljs-comment>// The name of the create function</span>
          create: <span class=hljs-string>&apos;create&apos;</span>,
          <span class=hljs-comment>// The name of the delete function</span>
          <span class=hljs-keyword>delete</span>: <span class=hljs-string>&apos;delete&apos;</span>,
          <span class=hljs-comment>// The name of the exists function</span>
          exists: <span class=hljs-string>&apos;exists&apos;</span>,
          <span class=hljs-comment>// (optional) The name of the getById function</span>
          getById: <span class=hljs-string>&apos;getById&apos;</span>,
          <span class=hljs-comment>// (optional) The name of the getInfo function</span>
          getInfo: <span class=hljs-string>&apos;getInfo&apos;</span>,
          <span class=hljs-comment>// The name of the update function</span>
          update: <span class=hljs-string>&apos;update&apos;</span>,
          <span class=hljs-comment>// The name of the validate function</span>
          validate: <span class=hljs-string>&apos;validate&apos;</span>,
          <span class=hljs-comment>// The name of the verify function</span>
          verify: <span class=hljs-string>&apos;verify&apos;</span>
        }
      }
    };
  }

  <span class=hljs-comment>/**
   * Optional.
   * Called after the strategy has been built with the constructor
   *
   * @param {*} constructedStrategy
   * @returns {Promise&lt;object&gt;}
   */</span>
  afterRegister (constructedStrategy) {
    <span class=hljs-comment>// do some action</span>
    <span class=hljs-built_in>Promise</span>.resolve(<span class=hljs-comment>/* any value */</span>);
  }

  <span class=hljs-comment>/**
   * Persists the provided credentials in some way
   * Must keep a link between the persisted credentials
   * and the kuid
   *
   * @param {KuzzleRequest} request
   * @param {object} credentials
   * @param {string} kuid
   * @returns {Promise&lt;object&gt;}
   */</span>
  create (request, credentials, kuid) {
    <span class=hljs-comment>// persist credentials</span>
    <span class=hljs-built_in>Promise</span>.resolve(<span class=hljs-comment>/* non sensitive credentials info */</span>);
  }

  <span class=hljs-comment>/**
   * Removes the user&apos;s stored credentials from
   * the plugin persistence layer
   *
   * @param {KuzzleRequest} request
   * @param {string} kuid
   * @returns {Promise&lt;object&gt;}
   */</span>
  <span class=hljs-keyword>delete</span> (request, kuid) {
    <span class=hljs-comment>// remove credentials</span>
    <span class=hljs-built_in>Promise</span>.resolve(<span class=hljs-comment>/* any value */</span>);
  }

  <span class=hljs-comment>/**
   * Checks if user&apos;s credentials exist in the persistence layer
   *
   * @param {KuzzleRequest} request
   * @param {string} kuid
   * @returns {Promise&lt;boolean&gt;}
   */</span>
  exists (request, kuid) {
    <span class=hljs-comment>// check credentials existence</span>
    <span class=hljs-built_in>Promise</span>.resolve(<span class=hljs-comment>/* true|false */</span>);
  }

  <span class=hljs-comment>/**
   * Optional.
   * Retrieves the non sensitive user&apos;s credentials information
   * from the persistence layer
   *
   * @param {KuzzleRequest} request
   * @param {string} kuid
   * @returns {Promise&lt;object&gt;}
   */</span>
  getInfo (request, kuid) {
    <span class=hljs-comment>// retrieve credentials</span>
    <span class=hljs-built_in>Promise</span>.resolve(<span class=hljs-comment>/* non sensitive credentials info */</span>);
  }

  <span class=hljs-comment>/**
   * Optional.
   * Retrieves the non sensitive user&apos;s credentials information
   * from the persistence layer using the strategy internal id
   *
   * @param {KuzzleRequest} request
   * @param {string} id
   * @returns {Promise&lt;object&gt;}
   */</span>
  getById (request, id) {
    <span class=hljs-comment>// retrieve credentials</span>
    <span class=hljs-built_in>Promise</span>.resolve(<span class=hljs-comment>/* non sensitive credentials info */</span>);
  }

  <span class=hljs-comment>/**
   * Updates the user&apos;s credentials information in the
   * persistence layer
   *
   * @param {KuzzleRequest} request
   * @param {object} credentials
   * @param {string} kuid
   * @returns {Promise&lt;object&gt;}
   */</span>
  update (request, credentials, kuid) {
    <span class=hljs-comment>// update credentials</span>
    <span class=hljs-built_in>Promise</span>.resolve(<span class=hljs-comment>/* non sensitive credentials info */</span>);
  }

  <span class=hljs-comment>/**
   * Validates credentials validity conforming to the
   * authentication strategy rules (mandatory fields,
   * password length, username uniqueness, ...)
   *
   * @param {KuzzleRequest} request
   * @param {object} credentials
   * @param {string} kuid
   * @param {boolean} isUpdate
   * @returns {Promise&lt;boolean&gt;}
   */</span>
  validate (request, credentials, kuid, isUpdate) {
    <span class=hljs-comment>// validate credentials</span>
    <span class=hljs-built_in>Promise</span>.resolve(<span class=hljs-comment>/* true|false */</span>);
  }

  <span class=hljs-comment>/**
   * Provided to the Passport strategy as verify function
   * Should return the kuid if the user can authentify
   * or an object with the login failure reason as message attribute
   *
   * @param {KuzzleRequest} request
   * @param {*[]} credentials - provided arguments depends on the Passport strategy
   * @returns {Promise&lt;string|{message: string}&gt;}
   */</span>
  verify (request, ...credentials) {
    <span class=hljs-comment>// verify if the user can authentify</span>
    <span class=hljs-keyword>const</span> kuid = getUserIdFromCredentials(credentials);

    <span class=hljs-keyword>if</span> (kuid) {
      <span class=hljs-keyword>return</span> <span class=hljs-built_in>Promise</span>.resolve(kuid);
    }

    <span class=hljs-keyword>return</span> <span class=hljs-built_in>Promise</span>.resolve({<span class=hljs-attr>message</span>: <span class=hljs-string>&apos;Login failed - You shall not pass! Reason: ...&apos;</span>});
  }
}

<span class=hljs-comment>// Exports the plugin objects, allowing Kuzzle to instantiate it</span>
<span class=hljs-built_in>module</span>.exports = AuthenticationPlugin;</code></pre><div style="clear: both"></div></div><hr><div id=disqus_thread></div><script async data-packer=exclude>var disqus_developer = 1;
      
        var disqus_config = function () {
          this.page.url = 'http://docs.kuzzle.io/plugins-reference/plugins-features/adding-authentication-strategy';
          this.page.title = 'Adding an authentication strategy';
          this.page.identifier = 'plugins-reference/plugins-features/adding-authentication-strategy';
        };
      
        (function() {
          var d = document, s = d.createElement('script');
          s.src = 'https://kuzzle-documentation.disqus.com/embed.js';
          s.async = 'async';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();</script><div class="nav-sibling bottom"><div class=nav-left><p><a href=https://github.com/kuzzleio/documentation/edit/master/src/plugins-reference/plugins-features/adding-authentication-strategy.md>edit on github<i class="icon icon-github icon-small"></i></a> <span class=separator>|</span> <a href="https://github.com/kuzzleio/documentation/issues/new?labels=plugins-reference&amp;title=Feedback%20about%20page%20&apos;plugins-reference/plugins-features/adding-authentication-strategy.md&apos;">send feedback about this content<i class="icon icon-github icon-small"></i></a> <span class=separator>|</span><select class=rate-documentation><option value=""></option><option value=1>Unusable documentation</option><option value=2>Poor documentation</option><option value=3>OK documentation</option><option value=4>Good documentation</option><option value=5>Excellent documentation</option></select></p></div><div class=nav-right><p class=medium-only></p><p><a href=#>back to top &#x2191;</a></p></div><div style=clear:both></div></div></div></div></div><script type=text/javascript data-packer=exclude>var path = 'plugins-reference/plugins-features/adding-authentication-strategy';
  var site_url = 'http://docs.kuzzle.io'
  var site_base_path = '/'
  var ancestry_parent_path = 'plugins-reference'
  var report404ga = ''
  var algolia_projectId = '4RFBRWISJR'
  var algolia_publicKey = '6febf1ebe906bd82bce58d5a20ac6c1b'</script><script src=/assets/javascript/e6791aa54bf763f10700a88b38d578282663be53.min.js></script></body></html>